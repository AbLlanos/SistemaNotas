<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${nota.idNota} != null ? 'Editar Nota' : 'Crear Nota'">Nota</title>
</head>
<body>

<h1 th:text="${nota.idNota} != null ? 'Editar Nota' : 'Crear Nota'"></h1>

<form th:action="@{/pages/Admin/notas/guardar}"
      method="post">

    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <!-- ID principal (solo edición) -->
    <input type="hidden" name="idNota" th:if="${nota.idNota != null}" th:value="${nota.idNota}"/>

    <!-- Claves originales (solo edición) -->
    <input type="hidden" name="originalCedula" th:if="${nota.idNota != null}" th:value="${nota.cedulaEstudiante}"/>
    <input type="hidden" name="originalMateria" th:if="${nota.idNota != null}" th:value="${nota.areaMateria}"/>
    <input type="hidden" name="originalPeriodo" th:if="${nota.idNota != null}" th:value="${nota.nombrePeriodo}"/>

    <!-- Estudiante -->
    <label for="cedulaEstudiante">Estudiante:</label>
    <select id="cedulaEstudiante" name="cedulaEstudiante"
            th:disabled="${nota.idNota != null}" required>
        <option value="" disabled th:selected="${nota.idNota == null}">Seleccione un estudiante</option>
        <th:block th:each="est : ${estudiantes}">
            <option th:value="${est.cedula}"
                    th:text="${est.cedula + ' - ' + est.nombre + ' ' + est.apellido}"
                    th:selected="${nota.idNota != null} ? (est.cedula == nota.cedulaEstudiante) : false">
            </option>
        </th:block>
    </select>
    <!-- cuando está disabled no envía valor, así que duplicamos hidden -->
    <input type="hidden" name="cedulaEstudiante" th:if="${nota.idNota != null}" th:value="${nota.cedulaEstudiante}"/>


    <!-- Materia -->
    <label for="areaMateria">Materia:</label>
    <select id="areaMateria" name="areaMateria"
            th:disabled="${nota.idNota != null}" required>
        <option value="" disabled th:selected="${nota.idNota == null}">Seleccione una materia</option>
        <th:block th:each="mat : ${materias}">
            <option th:value="${mat.nombre}"
                    th:text="${mat.nombre}"
                    th:selected="${nota.idNota != null} ? (mat.nombre == nota.areaMateria) : false">
            </option>
        </th:block>
    </select>
    <input type="hidden" name="areaMateria" th:if="${nota.idNota != null}" th:value="${nota.areaMateria}"/>


    <!-- Periodo -->
    <label for="periodo">Periodo Académico:</label>
    <select id="periodo" name="nombrePeriodo"
            th:disabled="${nota.idNota != null}" required>
        <option value="" disabled th:selected="${nota.idNota == null}">Seleccione un periodo</option>
        <th:block th:each="per : ${periodos}">
            <option th:value="${per.nombre}"
                    th:text="${per.nombre}"
                    th:selected="${nota.idNota != null} ? (per.nombre == nota.nombrePeriodo) : false">
            </option>
        </th:block>
    </select>
    <input type="hidden" name="nombrePeriodo" th:if="${nota.idNota != null}" th:value="${nota.nombrePeriodo}"/>


    <!-- ======= Primer Trimestre ======= -->
    <h3>Primer Trimestre</h3>
    <label for="notaNumerica1">Nota Numérica:</label>
    <input type="number" step="0.01" id="notaNumerica1" name="notaNumericaPrimerTrim"
           th:value="${nota.notaNumericaPrimerTrim}" />

    <label for="notaCualitativa1">Nota Cualitativa:</label>
    <input type="text" id="notaCualitativa1" name="notaCualitativaPrimerTrim"
           th:value="${nota.notaCualitativaPrimerTrim}" />

    <label for="asistencia1">Asistencias:</label>
    <input type="number" id="asistencia1" name="asistenciaPrimerTrim"
           th:value="${nota.asistenciaPrimerTrim}" />

    <label for="faltasJustificadas1">Faltas Justificadas:</label>
    <input type="number" id="faltasJustificadas1" name="faltasJustificadasPrimerTrim"
           th:value="${nota.faltasJustificadasPrimerTrim}" />

    <label for="faltasInjustificadas1">Faltas Injustificadas:</label>
    <input type="number" id="faltasInjustificadas1" name="faltasInjustificadasPrimerTrim"
           th:value="${nota.faltasInjustificadasPrimerTrim}" />

    <label for="atrasos1">Atrasos:</label>
    <input type="number" id="atrasos1" name="atrasosPrimerTrim"
           th:value="${nota.atrasosPrimerTrim}" />

    <label for="comportamiento1">Comportamiento:</label>
    <input type="text" id="comportamiento1" name="comportamientoPrimerTrim"
           th:value="${nota.comportamientoPrimerTrim}" />


    <!-- ======= Segundo Trimestre ======= -->
    <h3>Segundo Trimestre</h3>
    <label for="notaNumerica2">Nota Numérica:</label>
    <input type="number" step="0.01" id="notaNumerica2" name="notaNumericaSegundoTrim"
           th:value="${nota.notaNumericaSegundoTrim}" />

    <label for="notaCualitativa2">Nota Cualitativa:</label>
    <input type="text" id="notaCualitativa2" name="notaCualitativaSegundoTrim"
           th:value="${nota.notaCualitativaSegundoTrim}" />

    <label for="asistencia2">Asistencias:</label>
    <input type="number" id="asistencia2" name="asistenciaSegundoTrim"
           th:value="${nota.asistenciaSegundoTrim}" />

    <label for="faltasJustificadas2">Faltas Justificadas:</label>
    <input type="number" id="faltasJustificadas2" name="faltasJustificadasSegundoTrim"
           th:value="${nota.faltasJustificadasSegundoTrim}" />

    <label for="faltasInjustificadas2">Faltas Injustificadas:</label>
    <input type="number" id="faltasInjustificadas2" name="faltasInjustificadasSegundoTrim"
           th:value="${nota.faltasInjustificadasSegundoTrim}" />

    <label for="atrasos2">Atrasos:</label>
    <input type="number" id="atrasos2" name="atrasosSegundoTrim"
           th:value="${nota.atrasosSegundoTrim}" />

    <label for="comportamiento2">Comportamiento:</label>
    <input type="text" id="comportamiento2" name="comportamientoSegundoTrim"
           th:value="${nota.comportamientoSegundoTrim}" />


    <!-- ======= Tercer Trimestre ======= -->
    <h3>Tercer Trimestre</h3>
    <label for="notaNumerica3">Nota Numérica:</label>
    <input type="number" step="0.01" id="notaNumerica3" name="notaNumericaTercerTrim"
           th:value="${nota.notaNumericaTercerTrim}" />

    <label for="notaCualitativa3">Nota Cualitativa:</label>
    <input type="text" id="notaCualitativa3" name="notaCualitativaTercerTrim"
           th:value="${nota.notaCualitativaTercerTrim}" />

    <label for="asistencia3">Asistencias:</label>
    <input type="number" id="asistencia3" name="asistenciaTercerTrim"
           th:value="${nota.asistenciaTercerTrim}" />

    <label for="faltasJustificadas3">Faltas Justificadas:</label>
    <input type="number" id="faltasJustificadas3" name="faltasJustificadasTercerTrim"
           th:value="${nota.faltasJustificadasTercerTrim}" />

    <label for="faltasInjustificadas3">Faltas Injustificadas:</label>
    <input type="number" id="faltasInjustificadas3" name="faltasInjustificadasTercerTrim"
           th:value="${nota.faltasInjustificadasTercerTrim}" />

    <label for="atrasos3">Atrasos:</label>
    <input type="number" id="atrasos3" name="atrasosTercerTrim"
           th:value="${nota.atrasosTercerTrim}" />

    <label for="comportamiento3">Comportamiento:</label>
    <input type="text" id="comportamiento3" name="comportamientoTercerTrim"
           th:value="${nota.comportamientoTercerTrim}" />


    <br><br>
    <button type="submit"
            th:text="${nota.idNota != null ? 'Actualizar' : 'Guardar'}">
        Guardar
    </button>
</form>

</body>
</html>
